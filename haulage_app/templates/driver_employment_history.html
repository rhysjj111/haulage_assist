{% extends "std_template.html" %}

{% block standard_title %}Driver Employment History - {{ driver.full_name }}{% endblock %}

{% block main %}
<div class="container">
    <div class="row">
        <div class="col s12">
            <h4>Employment History - {{ driver.full_name }}</h4>
            
            <!-- Add New Employment Record -->
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Add New Employment Record</span>
                    <form method="POST" action="{{ url_for('driver.add_employment_history', driver_id=driver.id) }}">
                        <div class="row">
                            <div class="input-field col s12 m6">
                                <input id="start_date" name="start_date" type="text" class="datepicker" required>
                                <label for="start_date">Start Date (dd/mm/yyyy)</label>
                            </div>
                            <div class="input-field col s12 m6">
                                <input id="end_date" name="end_date" type="text" class="datepicker">
                                <label for="end_date">End Date (dd/mm/yyyy) - Leave blank if current</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <select name="employment_status" required>
                                    <option value="" disabled selected>Choose employment status</option>
                                    <option value="ACTIVE">Active</option>
                                    <option value="INACTIVE">Terminated</option>
                                </select>
                                <label>Employment Status</label>
                            </div>
                        </div>
                        <button class="btn waves-effect waves-light" type="submit">
                            Add Employment Record
                            <i class="material-icons right">send</i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Employment History List -->
            <div class="card">
                <div class="card-content">
                    <span class="card-title">Employment History Records</span>
                    {% if employment_history %}
                        <div class="collection">
                            {% for record in employment_history %}
                            <div class="collection-item">
                                <div class="row valign-wrapper">
                                    <div class="col s12 m8">
                                        <p>
                                            <strong>Start Date:</strong> {{ f.display_date(record.start_date) }}<br>
                                            <strong>End Date:</strong> 
                                            {% if record.end_date %}
                                                {{ f.display_date(record.end_date) }}
                                            {% else %}
                                                Current
                                            {% endif %}<br>
                                            <strong>Status:</strong> 
                                            <span class="badge {% if record.employment_status.value == 'active' %}green{% else %}red{% endif %} white-text">
                                                {{ record.employment_status.value.title() }}
                                            </span><br>
                                            <strong>Duration:</strong> {{ record.calculate_employment_duration_readable() }}
                                        </p>
                                    </div>
                                    <div class="col s12 m4">
                                        <div class="right-align">
                                            <!-- Edit Button -->
                                            <a class="btn-small blue waves-effect waves-light modal-trigger" 
                                               href="#edit-modal-{{ record.id }}">
                                                <i class="material-icons">edit</i>
                                            </a>
                                            <!-- Delete Button -->
                                            <a class="btn-small red waves-effect waves-light" 
                                               href="{{ url_for('driver.delete_employment_history', driver_id=driver.id, record_id=record.id) }}"
                                               onclick="return confirm('Are you sure you want to delete this employment record?')">
                                                <i class="material-icons">delete</i>
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Edit Modal -->
                                <div id="edit-modal-{{ record.id }}" class="modal">
                                    <div class="modal-content">
                                        <h4>Edit Employment Record</h4>
                                        <form method="POST" action="{{ url_for('driver.edit_employment_history', driver_id=driver.id, record_id=record.id) }}">
                                            <div class="row">
                                                <div class="input-field col s12 m6">
                                                    <input id="edit_start_date_{{ record.id }}" name="start_date" type="text" 
                                                           class="datepicker" value="{{ f.display_date(record.start_date) }}" required>
                                                    <label for="edit_start_date_{{ record.id }}" class="active">Start Date</label>
                                                </div>
                                                <div class="input-field col s12 m6">
                                                    <input id="edit_end_date_{{ record.id }}" name="end_date" type="text" 
                                                           class="datepicker" value="{% if record.end_date %}{{ f.display_date(record.end_date) }}{% endif %}">
                                                    <label for="edit_end_date_{{ record.id }}" class="active">End Date</label>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="input-field col s12">
                                                    <select name="employment_status" required>
                                                        <option value="ACTIVE" {% if record.employment_status.value == 'active' %}selected{% endif %}>Active</option>
                                                        <option value="INACTIVE" {% if record.employment_status.value == 'terminated' %}selected{% endif %}>Terminated</option>
                                                    </select>
                                                    <label>Employment Status</label>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="submit" class="btn green waves-effect waves-light">
                                                    Update Record
                                                </button>
                                                <a href="#!" class="modal-close btn grey waves-effect waves-light">Cancel</a>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No employment history records found for this driver.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Back to Driver Management -->
            <div class="fixed-action-btn">
                <a class="btn-floating btn-large blue" href="{{ url_for('driver.add_driver', item_id=0, tab='history') }}">
                    <i class="large material-icons">arrow_back</i>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Materialize components
    M.Datepicker.init(document.querySelectorAll('.datepicker'), {
        format: 'dd/mm/yyyy',
        yearRange: [1990, new Date().getFullYear() + 5]
    });
    M.FormSelect.init(document.querySelectorAll('select'));
    M.Modal.init(document.querySelectorAll('.modal'));
});
</script>
{% endblock %}